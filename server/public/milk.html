<html>
    <head>
        <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
        <script src="./geotools.js" crossorigin="anonymous"></script>
        <script src="my-haversine.js"></script>
        <title>Where is the nearest Raw Milk</title>


        <style>
            .myOL{list-style:none}
            .mySpan{
                color:red;
                font-weight:bold
            }
        </style>
    </head>
    <body>

        <select name="example" class="mySelect">
              <option value="A">A</option>
        </select><br>
        <input type="text" id="myInput">
        <button type="button" id="myBtn" href='#' onclick='loadMs();'>Find</button>

        <ol class="myOL">

        </ol>


        <script>
            function getIt(){
                console.log("everything");
            }


			//try to load the xml
            function loadRs(ar){
				$.ajax({
					type: "GET",
					url: './files',
                    dataType: "json",
                    success: function (json) { parseRs(json, ar); }
				});
            }

            function parseRs(json, ar){
                var json = $(json);
                $.each(json, function(i,obj){
                    //console.log();                
                    $('.mySelect').append('<option value="'+i+'">'+obj+'</option>');

                });

                $('.mySelect').val("0");
            }


			//try to load the xml
            function loadMs(ar){
                $.ajax({
                    type: "GET",
                    url: './data',
                    dataType: "json",
                    success: function (json) { parseMs(json, ar); }
                });
            }

            function parseMs(json, ar){
                var json = $(json);
                var myPostcode = $('.myInput').text();

                $.each(json, function(i,obj){
                    console.log(obj);
                    var distance;

                    $.ajax({
                        type: "GET",
                        url: './postcode-bgc/cv478jy',
                        dataType: "json",
                        success: function (postcodeBGC) {

                            //create a osgb coordinate
                            osgb=new GT_OSGB();
                            osgb.setGridCoordinates(623972, 308582);

                            //convert to a wgs84 coordinate
                            wgs84 = osgb.getWGS84();

                            distance =  myHaversine([wgs84.longitude,wgs84.latitude],[longi,lat]);
                        }
                    });







                    //now add the stuff here
                    $('.myOL').append('<li class="myLi"><span class="mySpan">Trading Name: </span>'
                        + obj.TradingName
                        + '<span class="mySpan">Address:  </span>'
                        + obj["Address1"] + obj["Address2"] + obj["Address3"] + obj["Address4"] + obj["address5"] + obj["Postcode"]
                        + '<span class="mySpan">Compliance rating: </span>'
                        + obj["ComplianceRating"]
                        + '<span class="mySpan">Has cows: </span>'
                        + obj['HasCows']
                        +'<span class="mySpan">Has goats: </span>'
                        + obj['HasGoats']
                        +'<span class="mySpan">Has horses: </span>'
                        + obj['HasHorses']
                        +'<span class="mySpan">Has sheep: </span>'
                        + obj['HasSheep']
                        +'<span class="mySpan">Has buffalo: </span>'
                        + obj['HasBuffalo']
                        +'<span class="mySpan">Distance: </span><span class="myDistSpan"></span>'
                        +'</li>')

                });

                $('.mySelect').val("0");
        }


        loadRs("");

        </script>
    </body>
</html>
